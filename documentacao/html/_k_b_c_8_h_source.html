<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Jogo do Galo: KBC.H Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>KBC.H</h1><a href="_k_b_c_8_h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef _KBC_H</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define _KBC_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;dos.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;pc.h&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="utypes_8h.html">utypes.h</a>&quot;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;<a class="code" href="_t_i_m_e_r_8_h.html">timer.h</a>&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="ints_8h.html">ints.h</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="_k_b_c_8_h.html#a11e96bc1936d8f631c98829b4c565b9f">00011</a> _go32_dpmi_seginfo <a class="code" href="_k_b_c_8_h.html#a11e96bc1936d8f631c98829b4c565b9f">old_irq2</a>;
<a name="l00012"></a><a class="code" href="_k_b_c_8_h.html#ac3e1795766a80ec63b157951b4b9a7d4">00012</a> <span class="keywordtype">int</span> <a class="code" href="_k_b_c_8_h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="_k_b_c_8_h.html#a34599ca5c55cb9be3b235d7422aff45c">00015</a> <span class="preprocessor">#define KBC_TIMEOUT 30 ///&lt; maximum amount of milliseconds to wait for KBC response/availability</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00019"></a><a class="code" href="_k_b_c_8_h.html#abf7206ca2181c36ef04b795c9b64e886">00019</a> <span class="preprocessor">#define CMD_REG   0x64  ///&lt; command register (read only)</span>
<a name="l00020"></a><a class="code" href="_k_b_c_8_h.html#a89c4d098b53809674457b1660b1af780">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define STAT_REG  0x64  ///&lt; status register  (write only)</span>
<a name="l00021"></a><a class="code" href="_k_b_c_8_h.html#a71b8ba376f687142f60a82d18c2715e0">00021</a> <span class="preprocessor"></span><span class="preprocessor">#define DATA_REG  0x60  ///&lt; data register    (read/write)</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00026"></a><a class="code" href="_k_b_c_8_h.html#a45967c9e25447ba853cf6fb4ac545fe6">00026</a> <span class="preprocessor">#define OBF     (1 &lt;&lt; 0) ///&lt; Output Buffer Full</span>
<a name="l00027"></a><a class="code" href="_k_b_c_8_h.html#a3c48b10907056351582baf9f6478598e">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define IBF     (1 &lt;&lt; 1) ///&lt; Input Buffer Full</span>
<a name="l00028"></a><a class="code" href="_k_b_c_8_h.html#a1b41fd2be63532d4ab910f8b256c3811">00028</a> <span class="preprocessor"></span><span class="preprocessor">#define AUX     (1 &lt;&lt; 5) ///&lt; 1 if data at DATA_REG came from mouse interface</span>
<a name="l00029"></a><a class="code" href="_k_b_c_8_h.html#a307ab71673e26ec42b28a3bca05d4cb5">00029</a> <span class="preprocessor"></span><span class="preprocessor">#define PAR_ERR (1 &lt;&lt; 7) ///&lt; Parity Error</span>
<a name="l00030"></a><a class="code" href="_k_b_c_8_h.html#ad16f61e2bf70f6c7685e826224ed177f">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define TO_ERR  (1 &lt;&lt; 6) ///&lt; Timeout Error</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00035"></a><a class="code" href="_k_b_c_8_h.html#a9f7743653801b79b2cf7c4a2707882ad">00035</a> <span class="preprocessor">#define ResetKBC   0xFF ///&lt; Reset the KBC interface</span>
<a name="l00036"></a><a class="code" href="_k_b_c_8_h.html#ae1856867674001a426a9ffb156affcd2">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define DefaultKBD 0xF6 ///&lt; Set default scancode and repeat rate</span>
<a name="l00037"></a><a class="code" href="_k_b_c_8_h.html#aaa35612ed5d4fdbe8000df239239713e">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define DisableKBD 0xF5 ///&lt; Historical Disable keyboard</span>
<a name="l00038"></a><a class="code" href="_k_b_c_8_h.html#a696342c5acdcc88677782c0f3133b549">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define EnableKBD  0xF4 ///&lt; Historical clear buffer and enable keyboard</span>
<a name="l00039"></a><a class="code" href="_k_b_c_8_h.html#a5e6859fb7c74889de02b86f3a03fec56">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define KBDRate    0xF3 ///&lt; Keyboard repeat rate, one arg, bits 0-4 repeat rate, bits 5-6 start delay</span>
<a name="l00040"></a><a class="code" href="_k_b_c_8_h.html#a59358190e83ceb32a586e77d01a536c6">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteLEDS  0xED ///&lt; Turn on/off KBD LEDS, one arg, one bit per led, bits 0-2, 0-off, 1-on</span>
<a name="l00041"></a><a class="code" href="_k_b_c_8_h.html#a1762a3d7ed4ff016f09dd89a931ac871">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define SCROLL_LOCK (1 &lt;&lt; 0) ///&lt; SCROLL_LOCK led for WriteLEDS command</span>
<a name="l00042"></a><a class="code" href="_k_b_c_8_h.html#a4dec6ba83b643ca753f0be5b167b02ae">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define NUM_LOCK    (1 &lt;&lt; 1) ///&lt; NUM__LOCK led for WriteLEDS command</span>
<a name="l00043"></a><a class="code" href="_k_b_c_8_h.html#a7d5d3b2ce697563a426c7fda967af9d7">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define CAPS_LOCK   (1 &lt;&lt; 2) ///&lt; CAPS_LOCK led for WriteLEDS command</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="_k_b_c_8_h.html#a6f6489887e08bff4887d0bc5dcf214d8">00048</a> <span class="preprocessor">#define ACK        0xFA ///&lt; Acknowledge OK response</span>
<a name="l00049"></a><a class="code" href="_k_b_c_8_h.html#a0ad9f0fd5fc87aa4630979da018fdb39">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define Resend     0xFE ///&lt; Resend error response; on multibyte commands the whole command must be resent from the beginning</span>
<a name="l00050"></a><a class="code" href="_k_b_c_8_h.html#a0f20a163dec609fb464cba845e043be8">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define Error      0xFC ///&lt; Error</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00055"></a><a class="code" href="_k_b_c_8_h.html#a99bbff320189ff927ad8d28b32d0a3e2">00055</a> <span class="preprocessor">#define ReadCommand   0x20 ///&lt; Read Command_Byte</span>
<a name="l00056"></a><a class="code" href="_k_b_c_8_h.html#a177bb59d36f14c1024b2de1601693605">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteCommand  0x60 ///&lt; Write Command_Byte, one arg</span>
<a name="l00057"></a><a class="code" href="_k_b_c_8_h.html#a884864c92108739e60113ca2079cbe71">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define DisableMouse  0xA7 ///&lt; Disable Mouse Interface </span>
<a name="l00058"></a><a class="code" href="_k_b_c_8_h.html#acaa321c74955e015d83da05cd321c0f8">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define EnableMouse   0xA8 ///&lt; Enable Mouse Interface </span>
<a name="l00059"></a><a class="code" href="_k_b_c_8_h.html#ab47f9ef099e1f33e026e5ee549900624">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define TestMouse     0xA9 ///&lt; Test Mouse Interface, returns 0 if OK</span>
<a name="l00060"></a><a class="code" href="_k_b_c_8_h.html#af555314895f7b6544624a51f22e3aeb0">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define Test8042      0xAA ///&lt; Test KBC, returns 0x55 if sucess, 0xFC on error</span>
<a name="l00061"></a><a class="code" href="_k_b_c_8_h.html#a5414bbfebe830e7887014106d3fd681e">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define TestKBD       0xAB ///&lt; Test mouse, returns 0 if OK</span>
<a name="l00062"></a><a class="code" href="_k_b_c_8_h.html#a69a0c992535a868edcb9362b52859914">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define NDisableKBD   0xAD ///&lt; New (versus historical) Disable keyboard</span>
<a name="l00063"></a><a class="code" href="_k_b_c_8_h.html#ace4e2548e5f13bab908c668fe5df5819">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define NEnableKBD    0xAE ///&lt; New (versus historical) Enable keyboard</span>
<a name="l00064"></a><a class="code" href="_k_b_c_8_h.html#a1ace60d764c21d4e3dfe01f6b9b401e0">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteMouse    0xD4 ///&lt; Write Mouse, one arg, see &quot;Commands for the Mouse&quot;</span>
<a name="l00065"></a><a class="code" href="_k_b_c_8_h.html#a01e50ef9f098e20f6b0b0429644862cf">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define ResetPC       0xFE ///&lt; Reset PC (reboot)</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="_k_b_c_8_h.html#afc6b776bcf10fb8d8c84c9e2a924025e">00072</a> <span class="preprocessor">#define INT_1    (1 &lt;&lt; 0)  ///&lt; Enable generation of interrupts from keyboard</span>
<a name="l00073"></a><a class="code" href="_k_b_c_8_h.html#a474732bbd6e6c485541a39fb44b88325">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define INT_12   (1 &lt;&lt; 1)  ///&lt; Enable generation of interrupts from mouse</span>
<a name="l00074"></a><a class="code" href="_k_b_c_8_h.html#a9e6ea2b423d7213db16c4975aaf38899">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define EN_KBD   (1 &lt;&lt; 4)  ///&lt; Enable keyboard interface</span>
<a name="l00075"></a><a class="code" href="_k_b_c_8_h.html#af9776e4566c3a77a7c3631530998f386">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define EN_MOUSE (1 &lt;&lt; 5)  ///&lt; Enable mouse interface</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="_k_b_c_8_h.html#ad6089b7326e09854f0670e5dd3b4612a">00082</a> <span class="preprocessor">#define MouseReset     0xFF</span>
<a name="l00083"></a><a class="code" href="_k_b_c_8_h.html#a1e9689f4bb2acbcbb8c83dde66b2192f">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define MouseDefaults  0xF6</span>
<a name="l00084"></a><a class="code" href="_k_b_c_8_h.html#ab0514340ae64ca6bd470fc518efb1409">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define StreamDisable  0xF5</span>
<a name="l00085"></a><a class="code" href="_k_b_c_8_h.html#a2ffc6eb402762e3b4f9c553796b9b060">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define StreamEnable 0xF4</span>
<a name="l00086"></a><a class="code" href="_k_b_c_8_h.html#a6109d272a7e0839b7ab18c38b50d8464">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define SampleRate   0xF3</span>
<a name="l00087"></a><a class="code" href="_k_b_c_8_h.html#a6e02bbb2debd87c4a931acec280494e8">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define ReadDevice   0xF2</span>
<a name="l00088"></a><a class="code" href="_k_b_c_8_h.html#accd8c46af3b38f50c99fbddd7703513d">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define RemoteMode   0xF0</span>
<a name="l00089"></a><a class="code" href="_k_b_c_8_h.html#ae59f0330db4123de14d87a2594c7f29c">00089</a> <span class="preprocessor"></span><span class="preprocessor">#define MouseReadData  0xEB</span>
<a name="l00090"></a><a class="code" href="_k_b_c_8_h.html#a89e4319b16638bfc84fafa1fb65ca0c2">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define EnterStream  0xEA</span>
<a name="l00091"></a><a class="code" href="_k_b_c_8_h.html#aef6666aa14f3bea60824b38ecfe4728d">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define StatusRequest 0xE9</span>
<a name="l00092"></a><a class="code" href="_k_b_c_8_h.html#a09e84fb09affc016c2800424cd09b7f6">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define Resolution   0xE8</span>
<a name="l00093"></a><a class="code" href="_k_b_c_8_h.html#aac83f3dad20cc9a631eb84be0676d358">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define Scaling2     0xE7</span>
<a name="l00094"></a><a class="code" href="_k_b_c_8_h.html#a517de159c505818ad67d371dbec33d53">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define Scaling1     0xE6</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="_k_b_c_8_h.html#a08deb639aef83c70892a364261b09133">00100</a> <span class="preprocessor">#define YOVF (1 &lt;&lt; 7) ///&lt; X overflow</span>
<a name="l00101"></a><a class="code" href="_k_b_c_8_h.html#ac3172c891b25dafed9ced2476aa03cf1">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define XOVF (1 &lt;&lt; 6) ///&lt; Y overflow</span>
<a name="l00102"></a><a class="code" href="_k_b_c_8_h.html#a5c610c7c656c4cf62564a959c30e0245">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define YSGN (1 &lt;&lt; 5) ///&lt; Sign of data packet byte 3 (y movement)</span>
<a name="l00103"></a><a class="code" href="_k_b_c_8_h.html#a1829ceaee57583878dbef19f0bc1a724">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define XSGN (1 &lt;&lt; 4) ///&lt; Sign of data packet byte 2 (x movement)</span>
<a name="l00104"></a><a class="code" href="_k_b_c_8_h.html#ab4abb667b74797a9a64f95d388c4da75">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define MBT  (1 &lt;&lt; 2) ///&lt; Middle button</span>
<a name="l00105"></a><a class="code" href="_k_b_c_8_h.html#abc6d7bd471913c986a226a3893174dfc">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define RBT  (1 &lt;&lt; 1) ///&lt; Right button</span>
<a name="l00106"></a><a class="code" href="_k_b_c_8_h.html#a6bec57496b9c9cc22e12e62997e5be91">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define LBT  (1 &lt;&lt; 0) ///&lt; Left button</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00111"></a><a class="code" href="_k_b_c_8_h.html#a37a6485f1a57d53c63b242f8692c9868">00111</a> <span class="preprocessor">#define LEFT_BUTTON(dt)   (((dt) &amp; LBT) == LBT) ///&lt; 1 if left button pressed</span>
<a name="l00112"></a><a class="code" href="_k_b_c_8_h.html#a8f2cffb043cf466894e2019ea14c400d">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define RIGHT_BUTTON(dt)  (((dt) &amp; RBT) == RBT) ///&lt; 1 if right button pressed</span>
<a name="l00113"></a><a class="code" href="_k_b_c_8_h.html#acfa9590af87bbf796387e1c6e01ef5c3">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define MIDDLE_BUTTON(dt) (((dt) &amp; MBT) == MBT) ///&lt; 1 if middle button pressed</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a><a class="code" href="_k_b_c_8_h.html#a43c087e52d2e7260fed09fc0cc7d5752">00115</a> <span class="preprocessor">#define Y_OVERFLOW(dt)    (((dt) &amp; XOVF) == XOVF) ///&lt; 1 if overflow in x movement</span>
<a name="l00116"></a><a class="code" href="_k_b_c_8_h.html#a8c9b6532dd05bc77e9bcef499868d98f">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define X_OVERFLOW(dt)    (((dt) &amp; YOVF) == YOVF) ///&lt; 1 if overflow in y movement</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a><a class="code" href="_k_b_c_8_h.html#aaf66ab279fa7f3781953d0c4422a7790">00118</a> <span class="preprocessor">#define X_SIGN(dt)        (((dt) &amp; XSGN) == XSGN ? -1 : 1) ///&lt; 1 if positive x movement, -1 if negative</span>
<a name="l00119"></a><a class="code" href="_k_b_c_8_h.html#aab5db4b8ea62f4cce4c01f703f0c8592">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define Y_SIGN(dt)        (((dt) &amp; YSGN) == YSGN ? -1 : 1) ///&lt; 1 if positive y movement, -1 if negative</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>
<a name="l00190"></a>00190 <span class="keywordtype">int</span> <a class="code" href="_k_b_c_8_h.html#a088f9ac488fbbf9ecf5a7238919c4e2c">kbc_init</a>(<span class="keywordtype">int</span> <a class="code" href="_k_b_c_8_h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   
<a name="l00200"></a>00200 <span class="keywordtype">int</span>  <a class="code" href="_k_b_c_8_c.html#ab19779ea7896435b3d4a5ff8a420f37e">write_kbc_data</a>( <span class="keywordtype">unsigned</span> data);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00209"></a>00209 <span class="keywordtype">int</span>  <a class="code" href="_k_b_c_8_c.html#a52a7ce44125208dfa303e597e6302a71">read_kbc</a>(<span class="keywordtype">void</span>);
<a name="l00210"></a>00210 
<a name="l00216"></a>00216 <span class="keywordtype">int</span>  <a class="code" href="_k_b_c_8_c.html#ad0f4763c978797b701c51fe3841ebdb0">write_kbc</a>(<span class="keywordtype">unsigned</span> adr, <span class="keywordtype">unsigned</span> data);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="keywordtype">void</span> <a class="code" href="_k_b_c_8_c.html#a71c80934bf15a4691e5a360fe0283227">enable_irq</a>(<span class="keywordtype">int</span> irq);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="keywordtype">void</span> <a class="code" href="_k_b_c_8_c.html#ac7a35f33ff72f90657561721b263c1d2">disable_irq</a>(<span class="keywordtype">int</span> irq);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu May 27 17:49:39 2010 for Jogo do Galo by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
